<!-- ? Preloader Start -->
<div id="preloader-active">
    <div class="preloader d-flex align-items-center justify-content-center">
      <div class="preloader-inner position-relative">
        <div class="preloader-circle"></div>
        <div class="preloader-img pere-text">
          <img src="assets/img/logo/loder.png" alt="">
        </div>
      </div>
    </div>
  </div>
  <!-- Preloader Start -->
  <header>
    <style>
        /* User dropdown styles */
        .user-dropdown-container {
            position: relative;
            display: inline-block;
        }

        .user-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #ff1313;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-icon:hover {
            background-color: #e60e0e;
        }

        .user-icon i {
            font-size: 18px;
        }

        .dropdown-menu {
    display: none;
    position: absolute;
    left: 0;  /* Changed from right: 0 to left: 0 */
    top: 50px;
    min-width: 220px;
    background-color: white;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    border-radius: 4px;
    padding: 10px 0;
    z-index: 999;
    transform: translateX(-70%); /* This centers the dropdown relative to the user icon */
}

/* For mobile responsiveness, you might want to add: */
@media (max-width: 400px) {
    .dropdown-menu {
        min-width: 200px;
        transform: translateX(-70%); /* Adjust as needed for smaller screens */
    }
}

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-email {
            padding: 10px 15px;
            font-weight: 500;
            color: #333;
            font-size: 14px;
            word-break: break-all;
            max-width: 350px;
        }

        .dropdown-divider {
            height: 1px;
            background-color: #eee;
            margin: 5px 0;
        }

        .dropdown-item {
            display: block;
            padding: 8px 15px;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .dropdown-item i {
            margin-right: 10px;
            width: 16px;
            text-align: center;
        }

        .dropdown-item:hover {
            background-color: #f8f9fa;
            color: #ff1313;
        }

        @media (max-width: 991px) {
            .user-dropdown-container {
                display: none;
            }
        }
    </style>
    <!--? Header Start -->
    <div class="header-area header-transparent">
      <div class="main-header header-sticky">
        <div class="container-fluid">
          <div class="row align-items-center">
            <!-- Logo -->
            <div class="col-xl-2 col-lg-2 col-md-1">
              <div class="logo">
                <a href="index.html"><img src="assets/img/logo/logo.png" alt=""></a>
              </div>
            </div>
            <div class="col-xl-10 col-lg-10 col-md-10">
              <div class="menu-main d-flex align-items-center justify-content-end">
                <!-- Main-menu -->
                <div class="main-menu f-right d-none d-lg-block">
                  <nav>
                    <ul id="navigation">
                      <li><a routerLink="/front">Home</a></li>
                      <li><a routerLink="/front/about">About</a></li>
                      <li><a routerLink="/front/services">Services</a></li>
                      <li><a routerLink="/front/schedule">Schedule</a></li>
                      <li><a routerLink="/front/gallery">Gallery</a></li>
                      <li><a (click)="navigateToRec()">Reclamation</a></li>
                      <li><a routerLink="/front/clubs">Clubs</a></li>
                      <li><a routerLink="/front/blog">Blog</a>
                        <ul class="submenu">
                          <li><a routerLink="/front/blog">Blog</a></li>
                          <li><a routerLink="/front/blog-details">Blog Details</a></li>
                          <li><a routerLink="/front/elements">Element</a></li>
                        </ul>
                      </li>
                      <li><a href="contact.html">Contact</a></li>
                    </ul>
                  </nav>
                </div>
                
                
                
                <!-- My Clubs Dropdown -->
                <div class="my-clubs-wrapper" (clickOutside)="closeMyClubsDropdown()">
                  <button class="btn my-clubs-btn" 
                          (click)="toggleMyClubsDropdown($event)"
                          [disabled]="isLoadingClubs">
                    
                    <div class="button-content">
                      <mat-icon>groups</mat-icon>
                      My Clubs
                      <mat-icon class="dropdown-arrow">
                        {{ isMyClubsDropdownOpen ? 'expand_less' : 'expand_more' }}
                      </mat-icon>
                    </div>
                
                    <mat-spinner *ngIf="isLoadingClubs" 
                                 diameter="20"
                                 mode="indeterminate"
                                 class="dropdown-spinner">
                    </mat-spinner>
                  </button>
                
                  <div class="my-clubs-dropdown" *ngIf="isMyClubsDropdownOpen">
                    <div *ngIf="errorLoadingClubs" class="error-message">
                      <mat-icon>error_outline</mat-icon>
                      <p>Error loading clubs. Please try again.</p>
                    </div>
                
                    <div *ngIf="userClubs.length === 0 && !isLoadingClubs" class="no-clubs">
                      <mat-icon>sentiment_dissatisfied</mat-icon>
                      <p>No clubs joined yet!</p>
                      <button mat-button color="primary" routerLink="/clubs">Find a club to join</button>
                    </div>
                
                    <div *ngFor="let club of userClubs" 
                         class="club-item"
                         (click)="navigateToUserClub(club.id_club)">
                      <div class="club-icon">
                        <div class="club-category-dot" [style.background-color]="getCategoryColor(club.categorie)"></div>
                      </div>
                      <div class="club-details">
                        <span class="club-name">{{ club.name }}</span>
                        <span class="club-category">{{ club.categorie }}</span>
                      </div>
                      <mat-icon class="navigate-icon">chevron_right</mat-icon>
                    </div>
                  </div>
                </div>
                
                 <!-- MODIFIED: Login button/user dropdown -->
                 <div class="header-right-btn f-right d-none d-lg-block ml-30">
                    <!-- Login button for logged out users -->
                    <a *ngIf="!isLoggedIn" href="#" class="btn header-btn" (click)="navigateToLogin(); $event.preventDefault()">Login</a>
                    
                    <!-- User dropdown for logged in users -->
                    <div *ngIf="isLoggedIn" class="user-dropdown-container">
                        <div class="user-icon" (click)="toggleDropdown($event)">
                            <i class="fas fa-user"></i>
                        </div>
                        
                        <div class="dropdown-menu" [class.show]="showDropdown">
                            <div class="dropdown-email">{{ userEmail }}</div>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" (click)="navigateToSettings()">
                                <i class="fas fa-cog"></i> Settings
                            </a>
                            <a class="dropdown-item" (click)="logout()">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </a>
                        </div>
                    </div>
                </div>
              </div>
            </div>
            <!-- Mobile Menu -->
            <div class="col-12">
              <div class="mobile_menu d-block d-lg-none"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Header End -->
  </header>
  
  <main>
    <!--? Hero Start -->
    <div class="slider-area2 ghibli-hero-background">
      <div class="slider-height2 d-flex align-items-center">
        <div class="container">
          <div class="row">
            <div class="col-xl-12">
              <div class="hero-cap hero-cap2 text-center pt-70">
                <h2>Discover our clubs</h2>
                <p class="hero-subtitle">Find your passion and join a community</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Hero End -->
  
    <!-- Statistics Dashboard -->
    <div class="stats-dashboard">
      <div class="stats-card club-total">
        <div class="stats-icon">
          <mat-icon>groups</mat-icon>
        </div>
        <div class="stats-content">
          <div class="stats-value">{{clubs.length}}</div>
          <div class="stats-label">Total clubs</div>
        </div>
      </div>
  
      <div class="stats-card members-total">
        <div class="stats-icon">
          <mat-icon>person</mat-icon>
        </div>
        <div class="stats-content">
          <div class="stats-value">{{getTotalMembers()}}</div>
          <div class="stats-label">Active members</div>
        </div>
      </div>
  
      <div class="stats-card categories-total">
        <div class="stats-icon">
          <mat-icon>category</mat-icon>
        </div>
        <div class="stats-content">
          <div class="stats-value">{{categories.length}}</div>
          <div class="stats-label">Categories</div>
        </div>
      </div>
  
      <div class="stats-card popular-club">
        <div class="stats-icon">
          <mat-icon>emoji_events</mat-icon>
        </div>
        <div class="stats-content">
          <div class="stats-value">{{getMostPopularClub()?.name || '-'}}</div>
          <div class="stats-label">Most popular club</div>
        </div>
      </div>
    </div>
  
    <!-- Category Distribution avec couleurs améliorées -->
    <div class="category-distribution">
      <h3>Distribution by category</h3>
      <div class="category-bars">
        <div *ngFor="let category of categories" class="category-bar">
          <div class="bar-label">{{category}}</div>
          <div class="bar-container">
            <div class="bar category-{{category.toLowerCase()}}" [style.width.%]="getPercentageByCategory(category)">
              <span class="bar-value" *ngIf="getPercentageByCategory(category) > 10">
                {{getClubCountByCategory(category)}}
              </span>
            </div>
            <span class="bar-value-outside" *ngIf="getPercentageByCategory(category) <= 10">
              {{getClubCountByCategory(category)}}
            </span>
          </div>
        </div>
      </div>
  
      <!-- Nouvelle section de recommandations -->
      <div class="recommendations-section" *ngIf="showRecommendations" @fadeInOut>
        <div class="recommendations-header">
          <div>
            <h3 class="recommendations-title">Clubs recommandés pour vous</h3>
            <p class="recommendations-subtitle">Basés sur vos intérêts</p>
          </div>
          <button mat-icon-button (click)="refreshRecommendations()" matTooltip="Actualiser les recommandations">
            <mat-icon>refresh</mat-icon>
          </button>
        </div>
  
        <div class="recommendations-carousel">
          <div class="recommendation-card" *ngFor="let club of recommendedClubs" (click)="navigateToClubDetails(club.id_club)">
            <div class="recommendation-actions">
              <button mat-icon-button class="ignore-btn" (click)="ignoreRecommendation($event, club.id_club)" matTooltip="Ne plus afficher">
                <mat-icon>close</mat-icon>
              </button>
            </div>
            <div class="recommendation-category" [ngClass]="'category-' + club.categorie.toLowerCase()">
              {{ club.categorie }}
            </div>
            <div class="recommendation-content">
              <h4>{{ club.name }}</h4>
              <p *ngIf="club.slogan" class="recommendation-slogan">"{{ club.slogan }}"</p>
              <p class="recommendation-description">{{ club.description | slice:0:80 }}...</p>
            </div>
            <div class="recommendation-footer">
              <span class="recommendation-members">
                <mat-icon>people</mat-icon>
                {{ getMemberCountText(club.members?.length || 0) }}
              </span>
              <button mat-button class="join-btn" (click)="joinClub($event, club.id_club)">
                <span>JOIN</span>
              </button>
            </div>
          </div>
        </div>
      </div>
  
      <!-- Search & Filter Bar -->
      <div class="search-filter-bar">
        <div class="search-box">
          <mat-form-field appearance="outline">
            <mat-label>Search...</mat-label>
            <input matInput [formControl]="searchControl" placeholder="Name...">
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>
        </div>
  
        <div class="category-filter">
          <mat-form-field appearance="outline">
            <mat-label>Categorie</mat-label>
            <mat-select [(ngModel)]="selectedCategory" (selectionChange)="onCategoryChange()">
              <mat-option value=""> All categories</mat-option>
              <mat-option *ngFor="let category of categories" [value]="category">
                {{category}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
  
        <div class="actions">
          <button mat-button color="primary" (click)="clearFilters()" *ngIf="selectedCategory || searchControl.value">
            <mat-icon>clear</mat-icon> Effacer les filtres
          </button>
          <button mat-icon-button (click)="toggleView()" matTooltip="Changer de vue">
            <mat-icon>{{viewMode === 'grid' ? 'view_list' : 'view_module'}}</mat-icon>
          </button>
        </div>
      </div>
  
      <!-- Results Counter -->
      <div class="results-counter">
        <p>{{filteredClubs.length}} club(s) found(s)</p>
      </div>
  
      <!-- Loading Spinner -->
      <div class="loading-spinner" *ngIf="isLoading">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Chargement des clubs...</p>
      </div>
  
      <!-- Error Message -->
      <div class="error-message" *ngIf="error">
        <mat-icon color="warn">error</mat-icon>
        <p>Une erreur est survenue lors du chargement des clubs.</p>
        <button mat-raised-button color="primary" (click)="fetchClubs()">Réessayer</button>
      </div>
  
      <!-- No Results Message -->
      <div class="no-results" *ngIf="!isLoading && !error && filteredClubs.length === 0">
        <mat-icon>search_off</mat-icon>
        <p>Aucun club ne correspond à votre recherche.</p>
        <button mat-button color="primary" (click)="clearFilters()">Réinitialiser les filtres</button>
      </div>
  
      <!-- Vue en grille améliorée -->
      <div class="clubs-grid" *ngIf="viewMode === 'grid' && !isLoading && filteredClubs.length > 0">
        <div class="club-card" *ngFor="let club of filteredClubs" (click)="navigateToClubDetails(club.id_club)">
          <!-- Badge de catégorie -->
          <div class="club-category" [ngClass]="'category-' + club.categorie.toLowerCase()">
            {{ club.categorie }}
          </div>
  
          <!-- Logo du club avec effet de superposition -->
          <div class="club-logo" *ngIf="club.logo">
            <img [src]="club.logo" alt="Logo {{ club.name }}">
            <div class="club-logo-overlay"></div>
          </div>
  
          <!-- En-tête du club -->
          <div class="club-header">
            <h3 class="club-title">{{ club.name }}</h3>
            <p class="club-slogan" *ngIf="club.slogan">"{{ club.slogan }}"</p>
          </div>
  
          <!-- Corps du contenu -->
          <div class="club-content">
            <p class="club-description">
              {{ club.showFullDescription ? club.description : (club.description | slice:0:100) }}
              <span *ngIf="club.description?.length > 100">
                {{ club.showFullDescription ? '' : '...' }}
              </span>
            </p>
          </div>
  
          <!-- Pied de carte -->
          <div class="club-footer">
            <span class="members-count">
              <mat-icon>people</mat-icon>
              {{ getMemberCountText(club.members?.length || 0) }}
            </span>
            <div class="club-actions">
              <button mat-button class="see-more-btn" (click)="toggleDescription($event, club)">
                {{ club.showFullDescription ? 'Show less' : ' Show more' }}
              </button>
              <button mat-button class="join-btn" (click)="joinClub($event, club.id_club)">
                <span>JOIN</span>
              </button>
            </div>
          </div>
        </div>
      </div>
  
      <!-- List View -->
      <div class="clubs-list" *ngIf="viewMode === 'list' && !isLoading && filteredClubs.length > 0">
        <mat-card *ngFor="let club of filteredClubs" (click)="navigateToClubDetails(club.id_club)">
          <mat-card-header>
            <div mat-card-avatar [style.background-color]="getCategoryColor(club.categorie)" class="category-avatar">
              {{club.categorie.charAt(0)}}
            </div>
            <mat-card-title>{{club.name}}</mat-card-title>
            <mat-card-subtitle>{{club.categorie}} · {{getMemberCountText(club.members?.length || 0)}}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <p *ngIf="club.slogan" class="slogan">"{{club.slogan}}"</p>
            <p>{{club.description}}</p>
          </mat-card-content>
          <mat-card-actions align="end">
            <button mat-button color="primary">VOIR DÉTAILS</button>
            <button mat-button color="accent" (click)="joinClub($event, club.id_club)">JOIN</button>
          </mat-card-actions>
        </mat-card>
      </div>
    </div>
  
    <!-- Bouton pour ouvrir le chat -->
    <button class="chat-toggle-btn" (click)="toggleChatPopup()" *ngIf="!isChatVisible">
      <mat-icon>chat</mat-icon>
      <span>Assistance</span>
    </button>
  
    <!-- Conteneur de la pop-up de chat -->
    <div class="chat-popup" [class.active]="isChatVisible" @fadeInOut>
      <div class="chat-popup-inner">
        <button class="close-chat-btn" (click)="toggleChatPopup()">
          <mat-icon>close</mat-icon>
        </button>
        <!-- Intégration du composant chat existant -->
        <app-chat></app-chat>
      </div>
    </div>
  
    <!-- Bouton pour afficher les blagues -->
    <button class="joke-toggle-btn" (click)="toggleJokePopup()" *ngIf="!isJokePopupVisible">
      <mat-icon>sentiment_very_satisfied</mat-icon>
      <span>Joke of the day</span>
    </button>
  
    <!-- Popup de blagues avec fonctionnalités de partage -->
    <div class="joke-popup" [class.active]="isJokePopupVisible" @fadeInOut>
      <div class="joke-popup-inner">
        <div class="joke-header">
          <div class="joke-header-content">
            <h2>Joke of the day</h2>
            <div class="joke-emoji">😂</div>
          </div>
          <button class="close-joke-btn" (click)="toggleJokePopup()" aria-label="Close joke popup">
            <mat-icon>close</mat-icon>
          </button>
        </div>
  
        <div class="joke-content">
          <div *ngIf="!currentJoke" class="joke-loading">
            <div class="joke-loader"></div>
            <p>Searching for a joke...</p>
          </div>
  
          <div *ngIf="currentJoke" class="joke-text" @fadeInOut>
            <p>{{ currentJoke }}</p>
          </div>
        </div>
  
        <div class="joke-actions">
          <button mat-raised-button class="joke-refresh-btn" (click)="fetchJoke()" aria-label="Get new joke">
            <mat-icon>refresh</mat-icon> New Joke
          </button>
  
          <button mat-button class="joke-share-btn" (click)="toggleShareOptions()" aria-label="Share joke">
            <mat-icon>share</mat-icon> {{ isSharingExpanded ? 'Close sharing' : 'Share' }}
          </button>
        </div>
  
        <!-- Improved Social Share Options -->
        <div class="social-share-options" *ngIf="isSharingExpanded && currentJoke" @fadeInOut>
          <div class="share-title">Share this joke</div>
          <div class="social-buttons">
            <button mat-mini-fab 
                  class="facebook-btn" 
                  (click)="shareJokeOn('facebook')" 
                  matTooltip="Share on Facebook"
                  aria-label="Share on Facebook">
              <mat-icon>facebook</mat-icon>
            </button>
  
            <button mat-mini-fab 
                  class="linkedin-btn" 
                  (click)="shareJokeOn('linkedin')" 
                  matTooltip="Share on LinkedIn"
                  aria-label="Share on LinkedIn">
              <mat-icon>linkedin</mat-icon>
            </button>
  
            <button mat-mini-fab 
                  class="email-btn" 
                  (click)="shareJokeOn('email')" 
                  matTooltip="Share by email"
                  aria-label="Share by email">
              <mat-icon>email</mat-icon>
            </button>
  
            <button mat-mini-fab 
                  class="copy-btn" 
                  (click)="shareJokeOn('copy')" 
                  matTooltip="Copy to clipboard"
                  aria-label="Copy to clipboard">
              <mat-icon>content_copy</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>
  
  <footer>
    <!--? Footer Start-->
    <div class="footer-area section-bg" data-background="assets/img/gallery/section_bg03.png">
      <div class="container">
        <div class="footer-top footer-padding">
          <!-- Footer Menu -->
          <div class="row d-flex justify-content-between">
            <div class="col-xl-2 col-lg-2 col-md-4 col-sm-6">
              <div class="single-footer-caption mb-50">
                <div class="footer-tittle">
                  <h4>COMPANY</h4>
                  <ul>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Company</a></li>
                    <li><a href="#"> Press & Blog</a></li>
                    <li><a href="#"> Privacy Policy</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-lg-3 col-md-4 col-sm-6">
              <div class="single-footer-caption mb-50">
                <div class="footer-tittle">
                  <h4>Open hour</h4>
                  <ul>
                    <li><a href="#">Monday 11am-7pm</a></li>
                    <li><a href="#"> Tuesday-Friday 11am-8pm</a></li>
                    <li><a href="#"> Saturday 10am-6pm</a></li>
                    <li><a href="#"> Sunday 11am-6pm</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
              <div class="single-footer-caption mb-50">
                <div class="footer-tittle">
                  <h4>RESOURCES</h4>
                  <ul>
                    <li><a href="#">Home Insurance</a></li>
                    <li><a href="#">Travel Insurance</a></li>
                    <li><a href="#"> Car Insurance</a></li>
                    <li><a href="#"> Business Insurance</a></li>
                    <li><a href="#"> Heal Insurance</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-lg-4 col-md-5 col-sm-6">
              <div class="single-footer-caption mb-50">
                <!-- logo -->
                <div class="footer-logo">
                  <a href="index.html"><img src="assets/img/logo/logo2_footer.png" alt=""></a>
                </div>
                <div class="footer-tittle">
                  <div class="footer-pera">
                    <p class="info1">GThe trade war currently ensuing between te US anfd several natxions around thdhe globe, most fiercely with.</p>
                  </div>
                </div>
                <!-- Footer Social -->
                <div class="footer-social ">
                  <a href="https://www.facebook.com/sai4ull"><i class="fab fa-facebook-f"></i></a>
                  <a href=""><i class="fab fa-twitter"></i></a>
                  <a href="#"><i class="fas fa-globe"></i></a>
                  <a href="#"><i class="fab fa-instagram"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Footer Bottom -->
        <div class="footer-bottom">
          <div class="row d-flex align-items-center">
            <div class="col-lg-12">
              <div class="footer-copy-right text-center">
                <p>
                  Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Footer End-->
  </footer>