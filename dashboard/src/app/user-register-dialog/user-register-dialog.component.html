<h2 mat-dialog-title>Register New User</h2>

<mat-dialog-content class="register-dialog-content">
  <form [formGroup]="registerForm">
    <div class="row">
      <!-- Left column -->
      <div class="col-md-6">
        <h3 class="section-title">Personal Information</h3>
        
        <!-- First name -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>First name</mat-label>
          <input matInput formControlName="firstname" required>
          <mat-icon matPrefix>person_outline</mat-icon>
          <mat-error *ngIf="firstname?.errors?.['required']">First name is required</mat-error>
          <mat-error *ngIf="firstname?.errors?.['minlength']">First name needs at least two characters</mat-error>
        </mat-form-field>
        
        <!-- Last name -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Last name</mat-label>
          <input matInput formControlName="lastname" required>
          <mat-icon matPrefix>person</mat-icon>
          <mat-error *ngIf="lastname?.errors?.['required']">Last name is required</mat-error>
          <mat-error *ngIf="lastname?.errors?.['minlength']">Last name needs at least two characters</mat-error>
        </mat-form-field>
        
        <!-- Birth date -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Birth date</mat-label>
          <input matInput [matDatepicker]="picker" formControlName="dateNaissance" [max]="maxDate" required>
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <mat-icon matPrefix>cake</mat-icon>
          <mat-error *ngIf="dateNaissance?.errors?.['required']">Birth date is required</mat-error>
        </mat-form-field>
        
        <!-- Gender -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Gender</mat-label>
          <mat-select formControlName="sexe" required>
            <mat-option value="Homme">Male</mat-option>
            <mat-option value="Femme">Female</mat-option>
          </mat-select>
          <mat-icon matPrefix>wc</mat-icon>
        </mat-form-field>
      </div>
      
      <!-- Right column -->
      <div class="col-md-6">
        <h3 class="section-title">Contact & Access</h3>
        
        <!-- Email -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Email</mat-label>
          <input matInput type="email" formControlName="email" required>
          <mat-icon matPrefix>email</mat-icon>
          <mat-error *ngIf="email?.errors?.['required']">Email is required</mat-error>
          <mat-error *ngIf="email?.errors?.['email']">Please enter a valid email address</mat-error>
        </mat-form-field>
        
        <!-- Phone number -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Phone number</mat-label>
          <input matInput type="tel" formControlName="numeroDeTelephone" required>
          <mat-icon matPrefix>phone</mat-icon>
          <mat-error *ngIf="numeroDeTelephone?.errors?.['required']">Phone number is required</mat-error>
          <mat-error *ngIf="numeroDeTelephone?.errors?.['pattern']">Please enter a valid number (8-12 digits)</mat-error>
        </mat-form-field>
        
        <!-- Password -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Password</mat-label>
          <input matInput [type]="hidePassword ? 'password' : 'text'" formControlName="password" required>
          <mat-icon matPrefix>lock</mat-icon>
          <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" type="button">
            <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-error *ngIf="password?.errors?.['required']">Password is required</mat-error>
          <mat-error *ngIf="password?.errors?.['minlength']">Password must be at least 6 characters</mat-error>
        </mat-form-field>
        
        <!-- Confirm Password -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Confirm password</mat-label>
          <input matInput [type]="hideConfirmPassword ? 'password' : 'text'" formControlName="confirmPassword" required>
          <mat-icon matPrefix>lock_outline</mat-icon>
          <button mat-icon-button matSuffix (click)="hideConfirmPassword = !hideConfirmPassword" type="button">
            <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-error *ngIf="confirmPassword?.errors?.['required']">Password confirmation is required</mat-error>
          <mat-error *ngIf="confirmPassword?.errors?.['passwordMismatch']">Passwords do not match</mat-error>
        </mat-form-field>
        
        <!-- Role -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Role</mat-label>
          <mat-select formControlName="id_role" required>
            <mat-option *ngFor="let role of roles" [value]="role.id">{{ role.name }}</mat-option>
          </mat-select>
          <mat-icon matPrefix>admin_panel_settings</mat-icon>
        </mat-form-field>
      </div>
    </div>

    <!-- Profile Photo -->
    <div class="photo-upload-section">
      <div class="photo-upload-label">
        <mat-icon>photo_camera</mat-icon>
        <span>Profile Photo</span>
      </div>
      
      <div class="photo-upload-content">
        <div class="photo-preview" [class.has-image]="imagePreview">
          <img *ngIf="imagePreview" [src]="imagePreview" alt="Profile photo">
          <mat-icon *ngIf="!imagePreview">account_circle</mat-icon>
        </div>
        
        <div class="photo-actions">
          <button type="button" mat-stroked-button color="primary" (click)="fileInput.click()">
            <mat-icon>upload</mat-icon> Choose photo
          </button>
          <input hidden type="file" #fileInput (change)="onFileSelected($event)" accept="image/png, image/jpeg, image/jpg">
          <p class="photo-tip">JPG or PNG, max 2MB</p>
        </div>
      </div>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()">Cancel</button>
  <button mat-raised-button color="primary" [disabled]="isLoading" (click)="onSubmit()">
    <span *ngIf="!isLoading">Register User</span>
    <mat-spinner *ngIf="isLoading" diameter="24" class="spinner-button"></mat-spinner>
  </button>
</mat-dialog-actions>